# 序言

歡迎來到《代理式設計模式：智慧系統建立實戰指南》。當我們審視現代人工智慧的全景時，我們看到一個清晰的演進：從簡單、被動的程式發展到複雜、自主的實體，能夠理解上下文、制定決策，並與環境和其他系統動態互動。這些就是智慧代理以及它們組成的代理式系統。

強大大語言模型 (LLM) 的出現為理解和生成類人內容 (如文字和媒體) 提供了前所未有的能力，成為許多這些代理的認知引擎。然而，將這些能力編排成能夠可靠實現複雜目標的系統需要的不僅僅是強大的模型。它需要結構、設計，以及對代理如何感知、規劃、行動和互動的深思熟慮方法。

將建立智慧系統想像成在畫布上創作複雜的藝術作品或工程。這個畫布不是空白的視覺空間，而是提供代理存在和運作環境與工具的底層基礎設施和框架。這是你建立智慧應用程式的基礎，管理狀態、通訊、工具存取和邏輯流程。

在這個代理式畫布上有效建立需要的不僅僅是將元件拼湊在一起。它需要理解經過驗證的技術——**模式**——來解決設計和實現代理行為時的常見挑戰。正如建築模式指導建築物的建造，或設計模式構建軟體，代理式設計模式為你在選定畫布上賦予智慧代理生命時面臨的反覆出現問題提供可重複使用的解決方案。

## 什麼是代理式系統？

代理式系統的核心是一個計算實體，設計來感知其環境 (數位和可能的實體)，基於這些感知和一組預定義或學習的目標做出明智決策，並執行行動以自主實現這些目標。與遵循嚴格、分步指令的傳統軟體不同，代理表現出一定程度的靈活性和主動性。

想像你需要一個系統來管理客戶詢問。傳統系統可能會遵循固定腳本。然而，代理式系統可以感知客戶查詢的細微差別，存取知識庫，與其他內部系統 (如訂單管理) 互動，可能提出澄清問題，並主動解決問題，甚至預測未來需求。這些代理在你應用程式基礎設施的畫布上運作，利用可用的服務和資料。

代理式系統通常具有**自主性**等特徵，允許它們在沒有持續人類監督下行動；**主動性**，朝向目標啟動行動；以及**反應性**，有效回應環境變化。它們根本上是**目標導向**的，持續朝向目標努力。關鍵能力是**工具使用**，讓它們能夠與外部 API、資料庫或服務互動——有效地延伸到它們直接畫布之外。它們擁有**記憶**，在互動中保留資訊，並能夠與使用者、其他系統，甚至在相同或連接畫布上運作的其他代理進行**通訊**。

有效實現這些特徵會帶來顯著的複雜性。代理如何在其畫布上的多個步驟中維持狀態？它如何決定*何時*和*如何*使用工具？不同代理之間的通訊如何管理？你如何在系統中建立韌性以處理意外結果或錯誤？

## 為什麼模式在代理開發中很重要

這種複雜性正是代理式設計模式不可或缺的原因。它們不是僵硬的規則，而是經過實戰驗證的模板或藍圖，為代理領域中的標準設計和實現挑戰提供經過驗證的方法。透過識別和應用這些設計模式，你可以獲得增強在畫布上建立的代理結構、可維護性、可靠性和效率的解決方案。

使用設計模式幫助你避免為管理對話流程、整合外部能力或協調多個代理行動等任務重新發明基礎解決方案。它們提供共同語言和結構，讓你的代理邏輯更清楚，讓其他人 (以及未來的你自己) 更容易理解和維護。實現為錯誤處理或狀態管理設計的模式直接有助於建立更強健和可靠的系統。利用這些既有方法加速你的開發過程，讓你能夠專注於應用程式的獨特方面，而非代理行為的基礎機制。

本書提取了 21 個關鍵設計模式，代表在各種技術畫布上建構複雜代理的基本建構塊和技術。理解和應用這些模式將顯著提升你有效設計和實現智慧系統的能力。

## 本書概述及使用方式

本書《代理式設計模式：智慧系統建立實戰指南》旨在成為一個實用且易於理解的資源。其主要焦點是清楚解釋每個代理式模式，並提供具體、可執行的程式碼範例來示範其實現。透過 21 個專門章節，我們將探索各種設計模式，從基礎概念如結構化序列操作 (提示鏈結) 和外部互動 (工具使用) 到更進階的主題如協作工作 (多代理協作) 和自我改進 (自我修正)。

本書按章節組織，每章深入探討單一代理式模式。在每章中，你將找到：

* 詳細的**模式概述**，清楚解釋模式及其在代理式設計中的角色。
* **實際應用與使用案例**章節，說明模式極具價值的真實場景及其帶來的好處。
* **實戰程式碼範例**，提供實用、可執行的程式碼，使用主要代理開發框架示範模式的實現。這是你將看到如何在技術畫布上下文中應用模式的地方。
* **關鍵重點**，總結最重要的要點供快速回顧。
* **參考資料**供進一步探索，提供模式和相關概念更深入學習的資源。

雖然章節按順序排列以漸進建立概念，但你可以隨意將本書作為參考使用，跳到解決你在自己代理開發專案中面臨特定挑戰的章節。附錄提供進階提示技術的全面介紹、在真實環境中應用 AI 代理的原則，以及重要代理式框架的概述。為了補充這些，包含了僅限線上的實用教學，提供使用特定平台 (如 AgentSpace) 和命令列介面建立代理的分步指導。始終強調實際應用；我們強烈鼓勵你執行程式碼範例、實驗它們，並調整它們來在你選擇的畫布上建立自己的智慧系統。

我經常聽到一個很好的問題：「AI 變化如此之快，為什麼要寫一本可能很快過時的書？」我的動機其實恰恰相反。正是因為事情變化如此之快，我們需要退後一步，識別正在穩固的底層原則。像 RAG、反思、路由、記憶和我討論的其他模式，正在成為基礎建構塊。這本書邀請對這些核心想法進行反思，它們提供我們需要建構的基礎。人類需要這些對基礎模式的反思時刻。

## 使用框架介紹

為了為我們的程式碼範例提供有形的「畫布」(另請參見附錄)，我們將主要使用三個重要的代理開發框架。**LangChain** 及其狀態化擴充 **LangGraph** 提供了將語言模型和其他元件鏈結在一起的靈活方式，為建立複雜的序列和操作圖提供強健的畫布。**Crew AI** 提供專門為編排多個 AI 代理、角色和任務而設計的結構化框架，作為特別適合協作代理系統的畫布。**Google 代理開發套件 (Google ADK)** 提供建立、評估和部署代理的工具和元件，提供另一個有價值的畫布，通常與 Google 的 AI 基礎設施整合。

這些框架代表代理開發畫布的不同面向，各有其優勢。透過在這些工具上展示範例，你將獲得對模式如何應用的更廣泛理解，無論你為代理式系統選擇何種特定技術環境。這些範例旨在清楚說明模式的核心邏輯及其在框架畫布上的實現，專注於清晰度和實用性。

在本書結束時，你不僅會理解 21 個重要代理式模式背後的基本概念，還會擁有有效應用它們的實用知識和程式碼範例，讓你能夠在選定的開發畫布上建立更智慧、更有能力、更自主的系統。讓我們開始這個實戰旅程！